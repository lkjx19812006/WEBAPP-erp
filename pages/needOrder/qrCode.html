<!DOCTYPE html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<title></title>
	<link href="../../css/mui.min.css" rel="stylesheet" />
	<!--国际化引入-->
	<script src="../../i18n/en.js"></script>
	<script src="../../i18n/zh_CN.js"></script>
	<style>
		#qrCode {
			padding-top: 45px;
			padding-bottom: 50px;
			padding-left: 20px;
			padding-right: 20px;
		}
		/*显示二维码区域*/
		
		#qrCode .qrCode-img-wrap {
			display: flex;
			flex-direction: row;
			justify-content: center;
			align-items: center;
			margin-top: 50px;
			padding: 20px;
			background-color: #fff;
		}
		
		.#qrCode .qrCode-img-wrap img {
			width: 100%;
		}
		/*底部操作按钮*/
		
		#qrCode .button-wrap {
			position: fixed;
			bottom: 0;
			left: 0;
			width: 100%;
			height: 50px;
			font-size: 18px;
			display: flex;
			flex-direction: row;
			justify-content: space-between;
			align-items: center;
		}
		
		#qrCode .button-wrap div {
			flex: 0 0 50%;
			height: 100%;
			line-height: 50px;
			text-align: center;
		}
		
		#qrCode .button-wrap div:nth-child(1) {
			background-color: #c0c0c0;
			color: #f0f0f0;
		}
		
		#qrCode .button-wrap div:nth-child(2) {
			background-color: #007AFF;
			color: #fff;
		}
	</style>
	</style>
</head>

<body>
	<div class="mui-content" id="qrCode">
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">二维码</h1>
		</header>
		<!--表单列表-->
		<div class="qrCode-img-wrap">
			<img id="qr"></img>
		</div>

		<!--提交按钮-->
		<div class="button-wrap">
			<div>
				返回
			</div>
			<div>
				分享
			</div>
		</div>
	</div>
	<script src="../../js/mui.min.js"></script>
	<script src="../../js/qrious.min.js"></script>
	<script src="../../libs/vue.min.js"></script>
	<script src="../../libs/vue-i18n.min.js"></script>
	<script src="../../libs/filters.js"></script>
	<script src="../../libs/crypto-js.js"></script>
	<script src="../../libs/httpService.js"></script>
	<script src="../../libs/vueComponents.js"></script>
	<script>
		//初始化
		mui.init({
			gestureConfig: {
				tap: true, //默认为true
				doubletap: true, //默认为false
				longtap: true, //默认为false			
			}
		});
		//加载完毕
		var offerPrice;
		//分享操作
		var shares = {};
		mui.plusReady(function() {
			offerPrice = plus.webview.currentWebview()
			plus.share.getServices(function(s) {
				if(s && s.length > 0) {
					for(var i = 0; i < s.length; i++) {
						var t = s[i];
						shares[t.id] = t;
					}
				}
			}, function() {
				console.log("获取分享服务列表失败");
			});
		})
		var vm = new Vue({
			el: '#qrCode',
			i18n: window.i18n,
			data: {},
			methods: {

			}
		})
		//二维码
		const qr = new QRious({
			element: document.getElementById('qr'),
			size: 265,
			level: 'L',
			mime: 'image/png',
			padding: 0,
			value: 'http://apps.yaocaimaimai.com/htm5/#/needDetails/a1a1a1a1a1a1a1a1a1a1a1a'
		});
		var btn = document.getElementById("qr");
		btn.addEventListener('longtap', function(e) {
			plus.nativeUI.actionSheet({
				cancel: "取消",
				buttons: [{
					title: "识别图中二维码"
				}, {
					title: "分享该链接"
				}]
			}, function(e) {
				switch(e.index) {
					case 1:
						//使用默认浏览器打开
						plus.runtime.openURL('http://apps.yaocaimaimai.com/htm5/#/needDetails/a1a1a1a1a1a1a1a1a1a1a1a');
						break;
					case 2:
						share();
						break;
					default:
						break;
				}
			});
		})
		//分享功能
		//分享链接点击事件
		function share() {
			var ids = [{
					id: "weixin",
					ex: "WXSceneSession"
				}, {
					id: "weixin",
					ex: "WXSceneTimeline"
				}, {
					id: "qq"
				}],
				bts = [{
					title: "发送给微信好友"
				}, {
					title: "分享到微信朋友圈"
				}, {
					title: "分享到QQ"
				}];
			plus.nativeUI.actionSheet({
				cancel: "取消",
				buttons: bts
			}, function(e) {
				var i = e.index;
				if(i > 0) {
					var s_id = ids[i - 1].id;
					var share = shares[s_id];
					if(share) {
						if(share.authenticated) {
							shareMessage(share, ids[i - 1].ex);
						} else {
							share.authorize(function() {
								shareMessage(share, ids[i - 1].ex);
							}, function(e) {
								console.log("认证授权失败：" + e.code + " - " + e.message);
							});
						}
					} else {
						mui.toast("无法获取分享服务，请检查manifest.json中分享插件参数配置，并重新打包")
					}
				}
			});
		}
		//分享标题
		function shareMessage(share, ex) {
			var msg = {
				extra: {
					scene: ex
				}
			};
			msg.href = "http://www.baidu.com";
			msg.title = "测试分享标题";
			msg.content = "测试分享内容";
			//			if(~share.id.indexOf('weibo')) {
			//				msg.content += "；体验地址：http://www.dcloud.io/hellomui/";
			//			}
			msg.thumbs = ["../../images/256x256.png"];
			share.send(msg, function() {
				console.log("分享到\"" + share.description + "\"成功！ ");
			}, function(e) {
				console.log("分享到\"" + share.description + "\"失败: " + e.code + " - " + e.message);
			});
		}
		console.log(btn);
	</script>
</body>

</html>