<!DOCTYPE html>
<html class="ui-page-login">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="../css/mui.min.css" rel="stylesheet" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<h1 class="mui-title">登录</h1>
		</header>
		<div class="mui-content" id="login">
			<form class="mui-input-group">
				<div class="mui-input-row">
					<label>账号</label>
					<input v-model='no' type="text" class="mui-input-clear mui-input" placeholder="请输入账号">
				</div>
				<div class="mui-input-row">
					<label>密码</label>
					<input v-model='password' type="password" class="mui-input-clear mui-input" placeholder="请输入密码">
				</div>
			</form>
			<form class="mui-input-group">
				<ul class="mui-table-view mui-table-view-chevron">
					<li class="mui-table-view-cell">
						自动登录
						<div id="autoLogin" class="mui-switch" @click="changeAutoLogin" :class="{'mui-active':autoLogin === 'on'}">
							<div class="mui-switch-handle"></div>
						</div>
					</li>
				</ul>
			</form>
			<div class="mui-content-padded">
				<button style="padding: 10px 0 ;" @click="submit" class="mui-btn mui-btn-block mui-btn-primary">登录</button>
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../libs/vue.min.js"></script>
		<script src="../libs/crypto-js.js"></script>
		<script src="../libs/httpService.js"></script>
		<script>
			var vm = new Vue({
				el: '#login',
				data: {
					no: '',
					password: '',
					autoLogin: 'on',
				},
				methods: {
					submit() {
						var obj = {
							biz_param: {
								no: this.no,
								password: this.password
							}
						}
						common.commonPost(common.commonUrl + common.apiUrl.login, obj).then((suc) => {
							common.setItem('KEY', suc.biz_result.KEY)
							common.setItem('SID', suc.biz_result.SID)
							//自动登录 记录账号密码
							if(vm.autoLogin === 'on') {
								common.setItem('no', this.no)
								common.setItem('password', this.password)
							} else {
								common.setItem('no', '')
								common.setItem('password', '')
							}
						})
						//打开新的窗口
						mui.openWindow({
							url: 'home.html',
							id: 'home',
							createNew: false, //是否重复创建同样id的webview，默认为false:不重复创建，直接显示
							waiting: {
								autoShow: true, //自动显示等待框，默认为true
								title: '正在加载...', //等待对话框上显示的提示内容
							}
						})
					},
					changeAutoLogin() {
						if(this.autoLogin === 'on') {
							this.autoLogin = 'off'
						} else {
							this.autoLogin = 'on'
						}
						common.setItem('autoLogin', this.autoLogin)
						console.log(common.getItem('autoLogin'))

					}
				}
			})
			//在mui.plusReady完成后 执行一些配置
			//自动登录 先判断本地 有无SID 有就登录 没有就留在登录页面 
			mui.plusReady(() => {
				vm.autoLogin = common.getItem('autoLogin');
				if(vm.autoLogin === 'on') {
					vm.no = common.getItem('no');
					vm.password = common.getItem('password');
					vm.submit()
				}
			})
		</script>
	</body>

</html>